{"componentChunkName":"component---node-modules-gatsby-theme-apollo-docs-src-components-template-js","path":"/security/authentication/","result":{"data":{"site":{"pathPrefix":"","siteMetadata":{"title":"akv2k8s docs","description":"How to get Azure Key Vault objects into Kubernetes"}},"file":{"childMarkdownRemark":{"frontmatter":{"title":"Authentication with Azure Key Vault","description":"Learn about the different options for authenticating with Azure Key Vault."},"headings":[{"value":"Situations where Default Authentication does not Work"},{"value":"AKV Authentication with the Controller"},{"value":"AKV Authentication with the Env-Injector"},{"value":"Custom AKV Authentication Options"}],"fields":{"image":"social-cards/authentication.png","graphManagerUrl":""},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"By default both the Controller and the Env Injector will assume it is running on Azure (since Azure Key Vault is most commonly used in Azure) - and use the default AKS credentials for authentication (a Service Principal or Azure Managed Identities) - unless custom authentication is provided."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Controller and Env-Injector have to handle AKV authentication quite differently, as the Controller is centralized and the Env-Injector executes in context of Pods."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For more details about AKV authentication, see:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#akv-authentication-with-the-controller"},"children":[{"type":"text","value":"AKV Authentication with the Controller"}]},{"type":"text","value":" for AKV Controller authentication options"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#akv-authentication-with-the-env-injector"},"children":[{"type":"text","value":"AKV Authentication with the Env-Injector"}]},{"type":"text","value":" for AKV Env-Injector authentication options"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"situations-where-default-authentication-does-not-work","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#situations-where-default-authentication-does-not-work","ariaLabel":"situations where default authentication does not work permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Situations where Default Authentication does not Work"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Currently only one situations has been identified, where default authentication does not work inside Azure."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"When a "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/policy/pod-security-policy/"},"children":[{"type":"text","value":"Pod Security Policy"}]},{"type":"text","value":" is configured in the cluster, preventing containers from reading from the host."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Two solutions exists:  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Change the Pod Security Policy to list "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/etc/kubernetes/azure.json"}]},{"type":"text","value":" under "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/policy/pod-security-policy/#volumes-and-file-systems"},"children":[{"type":"text","value":"AllowedHostPaths"}]},{"type":"text","value":" "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Or use custom authentication (see below). "}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"akv-authentication-with-the-controller","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#akv-authentication-with-the-controller","ariaLabel":"akv authentication with the controller permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"AKV Authentication with the Controller"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Controller will need AKV credentials to get Secrets from AKV and store them as Kubernetes Secrets. "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"If the default option (AKS credentials) works for you, use that."}]},{"type":"text","value":" If not, use custom authentication by passing inn the value "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"keyVault.customAuth.enabled=true"}]},{"type":"text","value":" to the Controller and pick one of the "},{"type":"element","tagName":"a","properties":{"href":"#custom-akv-authentication-options"},"children":[{"type":"text","value":"Authentication options"}]},{"type":"text","value":" described below."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Fore more details, see the "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/SparebankenVest/public-helm-charts/tree/master/stable/azure-key-vault-controller/README.md"},"children":[{"type":"text","value":"Controller Helm Chart"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"akv-authentication-with-the-env-injector","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#akv-authentication-with-the-env-injector","ariaLabel":"akv authentication with the env injector permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"AKV Authentication with the Env-Injector"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Env-Injector execute locally inside Pods and needs AKV credentials to download and inject secrets into container programs. You can either use default authentication (AKS credentials) or custom authentication. Use the following decision tree to find the best option:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"/3b4a8dcb89a89f1e6687868ca2f2cf21/auth-decision.svg","alt":"Authentication decision tree"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"For custom AKV authentication using Option 1 and akv2k8s versions "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"< 1.1.0"}]},{"type":"text","value":", set "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"customAuth.enabled=true"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"customAuth.autoInject.enabled=true"}]},{"type":"text","value":" to have the Env-Injector auto-inject credentials as a Kubernetes Secret into Pods. Akv2k8s versions "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"> 1.1.0"}]},{"type":"text","value":" handles this automatically through the auth-service introduced in version "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"1.1.0"}]},{"type":"text","value":" without using Kubernetes Secret."}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"For multi-tenant environments (using namespaces as isolation), Option 2 is currently the only viable option."}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Fore more details, see the "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/SparebankenVest/public-helm-charts/tree/master/stable/azure-key-vault-env-injector/README.md"},"children":[{"type":"text","value":"Env Injector Helm Chart"}]},{"type":"text","value":" and which custom AKV authentication options are available below."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"using-aad-pod-identity-and-msi-system-assigned-managed-identity-or-user-assigned-managed-identity","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#using-aad-pod-identity-and-msi-system-assigned-managed-identity-or-user-assigned-managed-identity","ariaLabel":"using aad pod identity and msi system assigned managed identity or user assigned managed identity permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Using aad-pod-identity and MSI (System Assigned Managed Identity or User Assigned Managed Identity)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"aad-pod-identity"}]},{"type":"text","value":" is installed in a cluster with MSI and akv2k8s, akv2k8s will not work out of the box, as documented by "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"aad-pod-identity"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The authorization request to fetch a Service Principal Token from an MSI endpoint is sent to Azure Instance Metadata Service (IMDS) endpoint (169.254.169.254), which is redirected to the NMI pod. "}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This will prevent akv2k8s to do MSI authentication requests directly with the MSI endpoint, because requests gets delayed by 10-60 seconds:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Identity assignment on VM takes 10-20s and 40-60s in case of VMSS."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Fortunately aad-pod-identity as the concept of application exceptions which will allow akv2k8s to handle MSI authentication requests directly:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"apiVersion: \"aadpodidentity.k8s.io/v1\"\nkind: AzurePodIdentityException\nmetadata:\n  name: akv2k8s-exception\n  namespace: akv2k8s # change if akv2k8s is installed in a different ns\nspec:\n  podLabels:\n    foo: bar\n    app: custom"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"See "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/Azure/aad-pod-identity/blob/master/docs/readmes/README.app-exception.md"},"children":[{"type":"text","value":"https://github.com/Azure/aad-pod-identity/blob/master/docs/readmes/README.app-exception.md"}]},{"type":"text","value":" for more details."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"using-custom-authentication-with-aad-pod-identity-aad-pod-identity","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#using-custom-authentication-with-aad-pod-identity-aad-pod-identity","ariaLabel":"using custom authentication with aad pod identity aad pod identity permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Using custom authentication with AAD Pod Identity (aad-pod-identity)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"First decide on either option 1 or 2 from the "},{"type":"element","tagName":"a","properties":{"href":"#akv-authentication-with-the-env-injector"},"children":[{"type":"text","value":"authentication decision tree"}]},{"type":"text","value":" above."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"option-1---pass-aad-pod-identity-to-the-env-injector","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-1---pass-aad-pod-identity-to-the-env-injector","ariaLabel":"option 1   pass aad pod identity to the env injector permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Option 1 - pass aad-pod-identity to the env-injector"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When installing the env-injector using the official "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/SparebankenVest/public-helm-charts/tree/master/stable/akv2k8s"},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"akv2k8s"}]}]},{"type":"text","value":" Helm chart, set the following values:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"--set env_injector.keyVault.customAuth.enabled=true\n--set env_injector.webhook.podLabels.aadpodidbinding=[your aad identity]"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"...or using the deprecated "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/SparebankenVest/public-helm-charts/tree/master/stable/azure-key-vault-env-injector"},"children":[{"type":"text","value":"azure-key-vault-env-injector"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"--set keyVault.customAuth.enabled=true\n--set webhook.podLabels.aadpodidbinding=[your aad identity]"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"option-2---pass-aad-pod-identity-to-every-application-pod","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-2---pass-aad-pod-identity-to-every-application-pod","ariaLabel":"option 2   pass aad pod identity to every application pod permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Option 2 - pass aad-pod-identity to every application pod"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"TBD"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"custom-akv-authentication-options","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#custom-akv-authentication-options","ariaLabel":"custom akv authentication options permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Custom AKV Authentication Options"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The following authentication options are available:"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tagName":"table","properties":{},"children":[{"type":"element","tagName":"thead","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"Authentication type"}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"Environment variable"}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"Description"}]}]}]},{"type":"element","tagName":"tbody","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"Managed identities for Azure resources (used to be MSI)"}]},{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"No credentials are needed for managed identity authentication. The Kubernetes cluster must be running in Azure and the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"aad-pod-identity"}]},{"type":"text","value":" controller must be installed. A "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AzureIdentity"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AzureIdentityBinding"}]},{"type":"text","value":" must be defined. See "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/Azure/aad-pod-identity"},"children":[{"type":"text","value":"https://github.com/Azure/aad-pod-identity"}]},{"type":"text","value":" for details."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"Client credentials"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_TENANT_ID"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The ID for the Active Directory tenant that the service principal belongs to."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_CLIENT_ID"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The name or ID of the service principal."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_CLIENT_SECRET"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The secret associated with the service principal."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"Certificate"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_TENANT_ID"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The ID for the Active Directory tenant that the certificate is registered with."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_CLIENT_ID"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The application client ID associated with the certificate."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_CERTIFICATE_PATH"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The path to the client certificate file."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_CERTIFICATE_PASSWORD"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The password for the client certificate."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"Username/Password"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_TENANT_ID"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The ID for the Active Directory tenant that the user belongs to."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_CLIENT_ID"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The application client ID."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_USERNAME"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The username to sign in with."}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AZURE_PASSWORD"}]}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"The password to sign in with."}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note: These env variables are sensitive and should be stored in a Kubernetes "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Secret"}]},{"type":"text","value":" resource, then referenced by "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets-as-environment-variables"},"children":[{"type":"text","value":"Using Secrets as Environment Variables"}]},{"type":"text","value":"."}]},{"type":"text","value":" "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"See official MS documentation for more details on how environment base authentication works for Azure: "},{"type":"element","tagName":"a","properties":{"href":"https://docs.microsoft.com/en-us/go/azure/azure-sdk-go-authorization#use-environment-based-authentication"},"children":[{"type":"text","value":"https://docs.microsoft.com/en-us/go/azure/azure-sdk-go-authorization#use-environment-based-authentication"}]}]}],"data":{"quirksMode":false}}},"childMdx":null}},"pageContext":{"id":"0e27c9f9-3c6a-557a-b1b8-80ad42775957","subtitle":"","versionDifference":0,"versionBasePath":"/v1.1","sidebarContents":[{"title":null,"pages":[{"title":"Overview","sidebarTitle":"","description":"Explore Azure Key Vault to Kubernetes","path":"/"},{"title":"Why use akv2k8s?","sidebarTitle":"","description":null,"path":"/why-akv2k8s/"},{"title":"Quick Start","sidebarTitle":"","description":"Quickly get started using Azure Key Vault to Kubernetes","path":"/quick-start/"},{"title":"How it Works","sidebarTitle":"","description":"Learn about the inner workings of akv2k8s.","path":"/how-it-works/"}]},{"title":"Installation","pages":[{"title":"Overview","sidebarTitle":"","description":"Different options for installing akv2k8s","path":"/installation/"},{"title":"Requirements","sidebarTitle":"","description":"Requirements for installing akv2k8s","path":"/installation/requirements/"},{"title":"Installation with Helm","sidebarTitle":"","description":"How to install Azure Key Vault to Kubernetes with Helm","path":"/installation/installing-with-helm/"},{"title":"Installation without Helm","sidebarTitle":"","description":"How to setup Azure Key Vault to Kubernetes","path":"/installation/installing-without-helm/"}]},{"title":"Tutorials","pages":[{"title":"Tutorials","sidebarTitle":"","description":"A quick introduction to the tutorials","path":"/tutorials/"},{"title":"Prerequisites","sidebarTitle":"","description":"A quick overview of the prerequisites needed to complete the tutorials","path":"/tutorials/prerequisites/"},{"title":"Sync Secret","sidebarTitle":"","description":"Sync a secret from Azure Key Vault into a Kubernetes Secret","path":"/tutorials/sync/1-secret/"},{"title":"Sync Certificate","sidebarTitle":"","description":"Sync a certificate from Azure Key Vault into a Kubernetes Secret.","path":"/tutorials/sync/2-certificate/"},{"title":"Sync Signing Key","sidebarTitle":"","description":"Sync signing key from Azure Key Vault into a Kubernetes Secret","path":"/tutorials/sync/3-signing-key/"},{"title":"Sync Multi Key Value Secret","sidebarTitle":"","description":"Sync a multi-key-value secret from Azure Key Vault into a Kubernetes Secret","path":"/tutorials/sync/4-multi-key-value-secret/"},{"title":"Inject Secret","sidebarTitle":"","description":"Inject an Azure Key Vault secret directly into a container application","path":"/tutorials/env-injection/1-secret/"},{"title":"Inject Certificate","sidebarTitle":"","description":"Inject an Azure Key Vault certificate key pair directly into a container application","path":"/tutorials/env-injection/2-certificate/"},{"title":"Inject Signing Key","sidebarTitle":"","description":"Inject a signing key from Azure Key Vault as environment variable into an application","path":"/tutorials/env-injection/3-signing-key/"},{"title":"Inject PFX Certificate","sidebarTitle":"","description":"Inject a PFX certificate from Azure Key Vault as environment variables into an application","path":"/tutorials/env-injection/5-pfx-certificate/"}]},{"title":"Security","pages":[{"title":"Authentication with Azure Key Vault","sidebarTitle":"","description":"Learn about the different options for authenticating with Azure Key Vault.","path":"/security/authentication/"},{"title":"Authorization","sidebarTitle":"","description":"Learn how to set the proper access rights in Azure Key Vault","path":"/security/authorization/"},{"title":"Enable Environment Injecton","sidebarTitle":"","description":"Learn how to enable environment injection per Kubernetes namespace","path":"/security/enable-env-injection/"}]},{"title":"Troubleshooting","pages":[{"title":"Get the akv2k8s Controller Log","sidebarTitle":"","description":"How to access the Controller log and specify log level","path":"/troubleshooting/controller-log/"},{"title":"Set env-injector log-level","sidebarTitle":"","description":"How to set the log-level for the env-injector","path":"/troubleshooting/env-injector-log-level/"},{"title":"Known Issues","sidebarTitle":"","description":"A list of known issues and available solutions or workarounds","path":"/troubleshooting/known-issues/"}]},{"title":"Reference","pages":[{"title":"Reference","sidebarTitle":"","description":"Reference of akv2k8s objects","path":"/reference/"},{"title":"AzureKeyVaultSecret","sidebarTitle":"","description":"Reference of AzureKeyVaultSecret custom resource definition","path":"/reference/azure-key-vault-secret/"}]}],"githubUrl":"https://github.com/sparebankenvest/azure-key-vault-to-kubernetes/tree/master/docs/source/content/security/authentication.md","spectrumUrl":"","twitterHandle":"","versions":["1.0"],"defaultVersion":"1.1","baseUrl":"https://akv2k8s.io"}},"staticQueryHashes":["1511030359","2468095761","2468095761","426988268","426988268"]}