<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e85073b34d5b007b6d5e.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}@font-face{font-family:Source Code Pro;font-style:normal;font-weight:400;src:local("Source Code Pro Regular"),local("SourceCodePro-Regular"),url(https://fonts.gstatic.com/s/sourcecodepro/v11/HI_SiYsKILxRpg3hIP6sJ7fM7PqlPevT.ttf) format("truetype")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:400;src:local("Source Sans Pro Regular"),local("SourceSansPro-Regular"),url(https://fonts.gstatic.com/s/sourcesanspro/v13/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7g.ttf) format("truetype")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:600;src:local("Source Sans Pro SemiBold"),local("SourceSansPro-SemiBold"),url(https://fonts.gstatic.com/s/sourcesanspro/v13/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlxdr.ttf) format("truetype")}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}body{font-family:Source Sans Pro,sans-serif}code,pre{font-family:Source Code Pro,monospace}html{font-size:100%;line-height:1.45;overflow-y:auto}body{color:#5a6270}h1,h2,h3,h4,h5,h6,img.screenshot,ol,p,ul{margin:0 0 1.45rem}h4,h5{margin-bottom:1.0875rem}h1,h2,h3,h4,h5,h6{line-height:1.1;color:#2f353f}h1,h2,h3,h4,h6{font-weight:400}h1{font-size:2.5rem}h2{font-size:1.73286rem}h3{font-size:1.4427rem}h4,li,p{font-size:1.125rem}h5{font-size:1rem}h6{font-size:.875rem}li,p{line-height:1.7}ol,ul{margin-left:1.45rem;padding:0}li{margin-bottom:.725rem}li>ol,li>ul{margin-top:.725rem}blockquote{margin-left:0;padding:12px 20px;border-left:2px solid #3f20ba}blockquote>p{font-size:inherit}blockquote>p:last-child{margin-bottom:0}form{margin-bottom:0}hr{height:1px;margin-bottom:calc(1.45rem - 1px);border:none;background-color:#dee2e7}img.screenshot{box-shadow:0 0 0 1px rgba(18,21,26,.04),0 1px 4px 0 rgba(0,0,0,.08);border-radius:8px}.gatsby-code-title{display:flex;align-items:center;margin-bottom:-50px;height:50px;font-size:15px;font-family:Source Code Pro,monospace;color:#5a6270;padding-left:19px}.gatsby-highlight-code-line{background-color:#ebeef0;display:block;margin-right:-1em;margin-left:-3.5em;padding-right:1em;padding-left:3.5em}.gatsby-highlight pre[class*=language-]{background-color:transparent;margin:0;padding:0;overflow:initial;float:left;min-width:100%}.gatsby-highlight pre[class*=language-].line-numbers{padding-left:2.5em}.gatsby-highlight pre[class*=language-].line-numbers .line-numbers-rows{border-right:none}.gatsby-highlight pre[class*=language-].line-numbers .line-numbers-rows>span:before{color:#cad0d8}code[class*=language-],pre[class*=language-]{color:#2f353f;font-size:15px;text-shadow:none;font-family:Source Code Pro,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#f4f6f8}:not(pre)>code[class*=language-]{padding:.1em .3em;border-radius:.3em;font-size:.9em;color:#f25cc1;background:#ebeef0}.namespace{opacity:.7}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#959daa}.token.punctuation{color:#5a6270}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#f25cc1}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#26a29d}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:inherit;background:transparent}.token.atrule,.token.attr-value,.token.keyword{color:#3f20ba}.token.class-name,.token.function{color:#f25cc1}.token.important,.token.regex,.token.variable{color:#f4d03f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[data-line]{position:relative}pre[class*=language-]>code[class*=language-]{position:relative}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}</style><meta name="generator" content="Gatsby 2.19.41"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-136446489-2"></script><script>
    window.GATSBY_GTAG_PLUGIN_GA_TRACKING_ID = (
      'UA-136446489-2'
    );
    window.GATSBY_GTAG_PLUGIN_ANONYMIZE = false;

    var options = {
      send_page_view: false
    };
    if (false) {
      options.anonymize_ip = true;
    }

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    window.gtag = gtag;
    gtag('js', new Date());
    gtag('config', 'UA-136446489-2', options);
  </script><title data-react-helmet="true">How it Works - akv2k8s docs</title><link data-react-helmet="true" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/><link data-react-helmet="true" rel="icon" href="https://apollographql.com/favicon.ico"/><meta data-react-helmet="true" name="description" content="How to get Azure Key Vault objects into Kubernetes"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/><meta data-react-helmet="true" property="og:title" content="How it Works"/><meta data-react-helmet="true" property="og:site_name" content="akv2k8s docs"/><meta data-react-helmet="true" property="og:description" content="Learn about the inner workings of akv2k8s."/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="How it Works"/><meta data-react-helmet="true" name="twitter:description" content="Learn about the inner workings of akv2k8s."/><meta data-react-helmet="true" property="og:image" content="/static/akv2k8s-b749ec5f4bfd805a88626e0fd2b9ba82.png"/><meta data-react-helmet="true" name="twitter:image" content="https://akv2k8s.io/static/akv2k8s-b749ec5f4bfd805a88626e0fd2b9ba82.png"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 64)
          }), 0)
        }
      }
    })
  </script><link as="script" rel="preload" href="/styles-1032cb06ce8f894b6274.js"/><link as="script" rel="preload" href="/component---node-modules-gatsby-theme-apollo-docs-src-components-template-js-29549b3bf4f45980f26c.js"/><link as="script" rel="preload" href="/commons-487d38bec414ba5177c2.js"/><link as="script" rel="preload" href="/app-1b0f35c4bd434e55dffd.js"/><link as="script" rel="preload" href="/webpack-runtime-3f707e416190fd69708e.js"/><link as="fetch" rel="preload" href="/page-data/how-it-works/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="bzzyjq">.css-bzzyjq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-height:100vh;max-width:1440px;margin:0 auto;}</style><div class="css-bzzyjq exdt29b0"><style data-emotion-css="1bs7gxh">.css-1bs7gxh{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:312px;height:100vh;padding:24px;border-right:1px solid #DEE2E7;overflow-y:auto;position:-webkit-sticky;position:sticky;top:0;}@media (max-width:850px){.css-1bs7gxh{height:100%;background-color:white;box-shadow:0 0 48px rgba(0,0,0,0.25);position:fixed;z-index:2;opacity:0;visibility:hidden;-webkit-transform:translateX(-100%);-ms-transform:translateX(-100%);transform:translateX(-100%);-webkit-transition-property:-webkit-transform,opacity,visibility;-webkit-transition-property:transform,opacity,visibility;transition-property:transform,opacity,visibility;-webkit-transition-duration:150ms;transition-duration:150ms;-webkit-transition-timing-function:ease-in-out;transition-timing-function:ease-in-out;}}</style><aside class="css-1bs7gxh ezgpdot1"><style data-emotion-css="7ieosi">.css-7ieosi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:24px;}</style><div class="css-7ieosi ezgpdot2"><style data-emotion-css="gbkvvb">.css-gbkvvb{color:#2F353F;-webkit-text-decoration:none;text-decoration:none;}</style><a href="https://akv2k8s.io/" class="css-gbkvvb ezgpdot3"><style data-emotion-css="70qvj9">.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-70qvj9 e1pvtjp70"><svg width="50" height="50" viewBox="0 0 209 203"><g fill="#326CE5"><path d="M89.5 12.1c-5.5 2.7-20.8 10.1-34 16.4C42.3 34.8 30.2 41 28.7 42.2c-3.1 2.6-2.6.6-12.7 44.8-3.3 14.6-6.5 28.4-7.1 30.7-.6 2.3-.9 5.7-.5 7.5.7 3.9 46.4 61.9 51.7 65.5 3.2 2.3 3.3 2.3 43.8 2.3 36.9 0 40.8-.2 43.3-1.8 3.2-2 49.3-59.2 51.5-63.8 1.7-3.4 1.9-1.9-4.2-27.9-.8-3.3-3.5-15-6-26-6.9-30.3-6.8-30-11.8-32.9-2.3-1.4-18.9-9.5-36.9-18-25.1-12-33.5-15.6-36.5-15.5-2.4 0-7.3 1.8-13.8 5zm27.6 21.2c9.1 3.8 16.9 16.1 16.9 26.6 0 10.7-7 22.1-16 26.2l-5 2.3V142H96v-11H83v-15h13V88l-3.4-1.4c-4.7-2-11.3-8.2-13.9-13-1.7-3.3-2.1-5.9-2.2-13.6 0-8.6.3-9.9 2.7-14.2 3.6-6 10-11.5 15.8-13.3 5.4-1.8 17-1.4 22.1.8zM70.6 71.8c1.6 4.2 1.5 4.4-.4 6.5-4.4 4.8-9.2 15.2-10.3 22.9-5.7 36.7 33.3 64.2 65.6 46.3 21.5-12 29.5-39.1 17.9-60.4-2-3.7-4.2-7.2-4.9-8-1.2-1.2-1.1-1.9.2-4.5.9-1.6 1.8-5.8 2.1-9.3.3-4.3.9-6.3 1.8-6.3 2.3 0 11.4 10.2 15.7 17.4 6.5 11.3 8 17.1 8.1 31.6.1 19.9-4.7 31.5-18.3 45-15.6 15.3-36.3 21.2-58.6 16.5-17.5-3.7-33.9-16.8-42-33.7-12-25-7.2-53.2 12.3-72.5l7.7-7.6.7 5.9c.4 3.2 1.5 7.8 2.4 10.2z"></path><path d="M99.3 48.5C93 51.2 90.2 59.7 93.5 66c4.6 8.9 17.3 9.3 22.5.7 3.9-6.4 1.4-14.9-5.4-18.1-4.1-1.9-7.1-2-11.3-.1z"></path></g></svg><style data-emotion-css="1jpvq8j">.css-1jpvq8j{font-size:24px;margin-left:16px;}</style><span style="color:#326CE5" class="css-1jpvq8j e1pvtjp71">akv2k8s docs</span></div></a></div><div class="sidebar"><style data-emotion-css="4ddkzq">.css-4ddkzq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-bottom:32px;}</style><span class="css-4ddkzq efh8xek5"><span class="title-sidebar"></span></span><style data-emotion-css="qomam7">.css-qomam7{margin-left:0;list-style:none;margin-bottom:32px;}</style><ul class="css-qomam7 emu0m580"><style data-emotion-css="s6dc9k">.css-s6dc9k{font-size:1rem;line-height:1.5;margin-bottom:0.8125rem;}.css-s6dc9k a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-s6dc9k a:hover{opacity:0.8;}.css-s6dc9k a.active{color:#3f20ba;pointer-events:none;}</style><li class="css-s6dc9k emu0m581"><a title="Explore Azure Key Vault to Kubernetes" href="/">Overview</a></li><li class="css-s6dc9k emu0m581"><a href="/why-akv2k8s/">Why use akv2k8s?</a></li><li class="css-s6dc9k emu0m581"><a title="Quickly get started using Azure Key Vault to Kubernetes" href="/quick-start/">Quick Start</a></li><li class="css-s6dc9k emu0m581"><a aria-current="page" class="active" title="Learn about the inner workings of akv2k8s." href="/how-it-works/">How it Works</a></li></ul><style data-emotion-css="av9mjd">.css-av9mjd{color:inherit;-webkit-letter-spacing:0.142em;-moz-letter-spacing:0.142em;-ms-letter-spacing:0.142em;letter-spacing:0.142em;text-transform:uppercase;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:12px;padding:4px 0;border:0;font-size:12px;font-weight:600;line-height:1;background:none;outline:none;cursor:pointer;}.css-av9mjd:hover{opacity:0.8;}.css-av9mjd svg{height:12px;width:12px;margin-right:8px;}</style><button class="css-av9mjd emu0m582"><style data-emotion-css="10zhkrl">.css-10zhkrl{overflow:visible;height:24px;}.css-10zhkrl *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-10zhkrl"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M3.75 15l7.72 7.72a.75.75 0 0 0 1.06 0L20.25 15M3.75 9l7.72-7.72a.749.749 0 0 1 1.059-.001l.001.001L20.25 9"></path></g></svg>Expand<!-- --> all</button><div><style data-emotion-css="4e6zf">.css-4e6zf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;border:0;padding:0.75em 0;color:#2F353F;background:none;outline:none;}.css-4e6zf h6{margin:0;font-weight:bold;-webkit-letter-spacing:0.142em;-moz-letter-spacing:0.142em;-ms-letter-spacing:0.142em;letter-spacing:0.142em;text-transform:uppercase;color:inherit;}.css-4e6zf svg{display:block;width:10px;height:10px;margin-left:auto;fill:currentColor;}.css-4e6zf.active{color:#3f20ba;}.css-4e6zf:not([disabled]){cursor:pointer;}.css-4e6zf:not([disabled]):hover{opacity:0.8;}</style><button class="false css-4e6zf eurzk6o0"><h6>Installation</h6><svg viewBox="0 0 24 24" style="visibility:visible" class="css-10zhkrl"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg></button><ul style="display:none" class="css-qomam7 emu0m580"><li class="css-s6dc9k emu0m581"><a title="Different options for installing akv2k8s" href="/installation/">Overview</a></li><li class="css-s6dc9k emu0m581"><a title="Requirements for installing akv2k8s" href="/installation/requirements/">Requirements</a></li><li class="css-s6dc9k emu0m581"><a title="How to install Azure Key Vault to Kubernetes with Helm" href="/installation/installing-with-helm/">Installation with Helm</a></li><li class="css-s6dc9k emu0m581"><a title="How to setup Azure Key Vault to Kubernetes" href="/installation/installing-without-helm/">Installation without Helm</a></li><li class="css-s6dc9k emu0m581"><a title="How to update Azure Key Vault to Kubernetes with Helm" href="/installation/updating-with-helm/">Upgrading  with Helm</a></li></ul></div><div><button class="false css-4e6zf eurzk6o0"><h6>Tutorials</h6><svg viewBox="0 0 24 24" style="visibility:visible" class="css-10zhkrl"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg></button><ul style="display:none" class="css-qomam7 emu0m580"><li class="css-s6dc9k emu0m581"><a title="A quick introduction to the tutorials" href="/tutorials/">Tutorials</a></li><li class="css-s6dc9k emu0m581"><a title="A quick overview of the prerequisites needed to complete the tutorials" href="/tutorials/prerequisites/">Prerequisites</a></li><li class="css-s6dc9k emu0m581"><a title="Sync a secret from Azure Key Vault into a Kubernetes Secret" href="/tutorials/sync/1-secret/">Sync Secret</a></li><li class="css-s6dc9k emu0m581"><a title="Sync a certificate from Azure Key Vault into a Kubernetes Secret." href="/tutorials/sync/2-certificate/">Sync Certificate</a></li><li class="css-s6dc9k emu0m581"><a title="Sync signing key from Azure Key Vault into a Kubernetes Secret" href="/tutorials/sync/3-signing-key/">Sync Signing Key</a></li><li class="css-s6dc9k emu0m581"><a title="Sync a multi-key-value secret from Azure Key Vault into a Kubernetes Secret" href="/tutorials/sync/4-multi-key-value-secret/">Sync Multi Key Value Secret</a></li><li class="css-s6dc9k emu0m581"><a title="Inject an Azure Key Vault secret directly into a container application" href="/tutorials/env-injection/1-secret/">Inject Secret</a></li><li class="css-s6dc9k emu0m581"><a title="Inject an Azure Key Vault certificate key pair directly into a container application" href="/tutorials/env-injection/2-certificate/">Inject Certificate</a></li><li class="css-s6dc9k emu0m581"><a title="Inject a signing key from Azure Key Vault as environment variable into an application" href="/tutorials/env-injection/3-signing-key/">Inject Signing Key</a></li><li class="css-s6dc9k emu0m581"><a title="Inject a PFX certificate from Azure Key Vault as environment variables into an application" href="/tutorials/env-injection/5-pfx-certificate/">Inject PFX Certificate</a></li></ul></div><div><button class="false css-4e6zf eurzk6o0"><h6>Security</h6><svg viewBox="0 0 24 24" style="visibility:visible" class="css-10zhkrl"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg></button><ul style="display:none" class="css-qomam7 emu0m580"><li class="css-s6dc9k emu0m581"><a title="Learn about the different options for authenticating with Azure Key Vault." href="/security/authentication/">Authentication</a></li><li class="css-s6dc9k emu0m581"><a title="Learn how to set the proper access rights in Azure Key Vault" href="/security/authorization/">Authorization</a></li><li class="css-s6dc9k emu0m581"><a title="Learn how to enable environment injection per Kubernetes namespace" href="/security/enable-env-injection/">Enable Environment Injecton</a></li></ul></div><div><button class="false css-4e6zf eurzk6o0"><h6>Availability</h6><svg viewBox="0 0 24 24" style="visibility:visible" class="css-10zhkrl"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg></button><ul style="display:none" class="css-qomam7 emu0m580"></ul></div><div><button class="false css-4e6zf eurzk6o0"><h6>Troubleshooting</h6><svg viewBox="0 0 24 24" style="visibility:visible" class="css-10zhkrl"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg></button><ul style="display:none" class="css-qomam7 emu0m580"><li class="css-s6dc9k emu0m581"><a title="How to access the Controller log and specify log level" href="/troubleshooting/controller-log/">Get the akv2k8s Controller Log</a></li><li class="css-s6dc9k emu0m581"><a title="How to set the log-level for the env-injector" href="/troubleshooting/env-injector-log-level/">Set env-injector log-level</a></li><li class="css-s6dc9k emu0m581"><a title="A list of known issues and available solutions or workarounds" href="/troubleshooting/known-issues/">Known Issues</a></li></ul></div><div><button class="false css-4e6zf eurzk6o0"><h6>Reference</h6><svg viewBox="0 0 24 24" style="visibility:visible" class="css-10zhkrl"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg></button><ul style="display:none" class="css-qomam7 emu0m580"><li class="css-s6dc9k emu0m581"><a title="Reference of akv2k8s objects" href="/reference/">Reference</a></li><li class="css-s6dc9k emu0m581"><a title="Reference of AzureKeyVaultSecret custom resource definition" href="/reference/azure-key-vault-secret/">AzureKeyVaultSecret</a></li><li class="css-s6dc9k emu0m581"><a title="Azure Key Vault Controller reference" href="/stable/azure-key-vault-controller/README/">Controller Helm Chart</a></li><li class="css-s6dc9k emu0m581"><a title="Azure Key Vault Env-Injector reference" href="/stable/azure-key-vault-env-injector/README/">Env-Injector Helm Chart</a></li></ul></div></div></aside><style data-emotion-css="i9gxme">.css-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><main class="css-i9gxme efh8xek0"><style data-emotion-css="o3chs1">.css-o3chs1{position:-webkit-sticky;position:sticky;top:0;left:0;z-index:1;}</style><header class="css-o3chs1 edldhn50"><style data-emotion-css="kdqfuf">.css-kdqfuf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:64px;padding:0 56px;background-color:white;}@media (max-width:850px){.css-kdqfuf{padding:0 24px;}}</style><div class="css-kdqfuf edldhn51"><style data-emotion-css="8jbk1d">.css-8jbk1d{display:none;}@media (max-width:850px){.css-8jbk1d{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:32px;color:#2F353F;}}</style><div class="css-8jbk1d efh8xek4"><style data-emotion-css="1m6zll5">.css-1m6zll5{padding:20px;margin-left:-20px;color:inherit;border:none;background:none;outline:none;cursor:pointer;}</style><button class="css-1m6zll5 e1qf1exz0"><style data-emotion-css="1ihqbbj">.css-1ihqbbj{height:24px;width:24px;display:block;fill:currentColor;}</style><style data-emotion-css="19ilpbi">.css-19ilpbi{overflow:visible;height:24px;height:24px;width:24px;display:block;fill:currentColor;}.css-19ilpbi *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="e1qf1exz1 css-19ilpbi"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M2.25 18.003h19.5M2.25 12.003h19.5M2.25 6.003h19.5"></path></g></svg></button><svg width="32" height="40" viewBox="0 0 209 203" fill="currentColor"><g fill="#326CE5"><path d="M89.5 12.1c-5.5 2.7-20.8 10.1-34 16.4C42.3 34.8 30.2 41 28.7 42.2c-3.1 2.6-2.6.6-12.7 44.8-3.3 14.6-6.5 28.4-7.1 30.7-.6 2.3-.9 5.7-.5 7.5.7 3.9 46.4 61.9 51.7 65.5 3.2 2.3 3.3 2.3 43.8 2.3 36.9 0 40.8-.2 43.3-1.8 3.2-2 49.3-59.2 51.5-63.8 1.7-3.4 1.9-1.9-4.2-27.9-.8-3.3-3.5-15-6-26-6.9-30.3-6.8-30-11.8-32.9-2.3-1.4-18.9-9.5-36.9-18-25.1-12-33.5-15.6-36.5-15.5-2.4 0-7.3 1.8-13.8 5zm27.6 21.2c9.1 3.8 16.9 16.1 16.9 26.6 0 10.7-7 22.1-16 26.2l-5 2.3V142H96v-11H83v-15h13V88l-3.4-1.4c-4.7-2-11.3-8.2-13.9-13-1.7-3.3-2.1-5.9-2.2-13.6 0-8.6.3-9.9 2.7-14.2 3.6-6 10-11.5 15.8-13.3 5.4-1.8 17-1.4 22.1.8zM70.6 71.8c1.6 4.2 1.5 4.4-.4 6.5-4.4 4.8-9.2 15.2-10.3 22.9-5.7 36.7 33.3 64.2 65.6 46.3 21.5-12 29.5-39.1 17.9-60.4-2-3.7-4.2-7.2-4.9-8-1.2-1.2-1.1-1.9.2-4.5.9-1.6 1.8-5.8 2.1-9.3.3-4.3.9-6.3 1.8-6.3 2.3 0 11.4 10.2 15.7 17.4 6.5 11.3 8 17.1 8.1 31.6.1 19.9-4.7 31.5-18.3 45-15.6 15.3-36.3 21.2-58.6 16.5-17.5-3.7-33.9-16.8-42-33.7-12-25-7.2-53.2 12.3-72.5l7.7-7.6.7 5.9c.4 3.2 1.5 7.8 2.4 10.2z"></path><path d="M99.3 48.5C93 51.2 90.2 59.7 93.5 66c4.6 8.9 17.3 9.3 22.5.7 3.9-6.4 1.4-14.9-5.4-18.1-4.1-1.9-7.1-2-11.3-.1z"></path></g></svg></div><style data-emotion-css="2sza2b">.css-2sza2b{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;visibility:hidden;background-color:rgba(90,98,112,0.5);-webkit-transition-property:opacity,visibility;transition-property:opacity,visibility;-webkit-transition-duration:150ms;transition-duration:150ms;-webkit-transition-timing-function:ease-in-out;transition-timing-function:ease-in-out;z-index:1;}</style><div class="css-2sza2b e1vsvaua3"></div><style data-emotion-css="1kblkc9">.css-1kblkc9{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;margin-right:40px;color:#5A6270;position:relative;z-index:1;}@media (max-width:850px){.css-1kblkc9{margin-right:0;}}.css-1kblkc9 .algolia-autocomplete{width:100%;}.css-1kblkc9 .algolia-autocomplete .ds-dropdown-menu{width:100%;max-width:100%;min-width:auto;margin-top:14px;border-radius:5px;box-shadow:rgba(0,0,0,0.1) 0 2px 12px;}.css-1kblkc9 .algolia-autocomplete .ds-dropdown-menu::before{display:none;}.css-1kblkc9 .algolia-autocomplete .ds-dropdown-menu [class^=ds-dataset-]{max-height:calc(100vh - 64px - 32px);padding:0;border:1px solid #959DAA;border-radius:inherit;}.css-1kblkc9 .algolia-autocomplete .ds-dropdown-menu .ds-suggestions{margin-top:0;}.css-1kblkc9 .algolia-autocomplete .ds-dropdown-menu .ds-suggestion{padding:20px 32px;border-bottom:1px solid #DEE2E7;}.css-1kblkc9 .algolia-autocomplete .ds-dropdown-menu .ds-suggestion.ds-cursor{background-color:rgba(222,226,231,0.5);}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion{padding:0;color:inherit;background:none;-webkit-text-decoration:none;text-decoration:none;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--wrapper,.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--subcategory-column,.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--content{width:auto;float:none;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--wrapper{padding-top:0;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--category-header{margin-top:0;margin-bottom:4px;border-bottom:0;font-size:14px;color:inherit;-webkit-letter-spacing:0.142em;-moz-letter-spacing:0.142em;-ms-letter-spacing:0.142em;letter-spacing:0.142em;text-transform:uppercase;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--subcategory-column,.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--content{padding:0;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--subcategory-column::before,.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--content::before{display:none;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--subcategory-column{margin-bottom:4px;font-size:22px;color:#2F353F;text-align:initial;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--content{background:none !important;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--title{margin-bottom:0;font-size:18px;font-weight:normal;color:inherit;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--highlight{box-shadow:none !important;color:#3f20ba !important;background:none !important;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-suggestion--no-results{padding:32px;}.css-1kblkc9 .algolia-autocomplete .algolia-docsearch-footer{margin:12px;}</style><div class="css-1kblkc9 e1vsvaua1"><style data-emotion-css="1es5zjy">.css-1es5zjy{width:100%;height:42px;padding:0;padding-left:16px;border:1px solid #959DAA;border-radius:5px;box-shadow:none;font-size:16px;background:white;outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;}</style><input id="input" value="" placeholder="Search " class="css-1es5zjy e1vsvaua2"/><style data-emotion-css="knt3s7">.css-knt3s7{position:absolute;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);height:24px;width:24px;border:1px solid #959DAA;border-color:#CAD0D8;color:#CAD0D8;border-radius:5px;text-align:center;line-height:1.125;right:10px;pointer-events:none;}</style><div class="css-knt3s7 e1vsvaua0">/</div></div></div></header><style data-emotion-css="ifkzhd">.css-ifkzhd{padding:40px 56px;padding-bottom:0;}@media (max-width:850px){.css-ifkzhd{padding:32px 48px;}}@media (max-width:600px){.css-ifkzhd{padding:24px 32px;}}</style><div class="css-ifkzhd ernxcdh0"><div class="header-wrapper"><style data-emotion-css="cz947x">.css-cz947x:not(:last-child){margin-bottom:8px;}</style><h1 class="css-cz947x ei8t6h40">How it Works</h1><style data-emotion-css="kfq87l">.css-kfq87l{color:#5A6270;}</style><h3 class="css-kfq87l ei8t6h41">Learn about the inner workings of akv2k8s.</h3></div><hr/><style data-emotion-css="1yp4ln">.css-1yp4ln{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-1yp4ln e694h6z0"><style data-emotion-css="j4wukh">.css-j4wukh{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;width:0;}</style><div class="css-j4wukh e694h6z1"><style data-emotion-css="844n2c">.css-844n2c a[href]:not([class]){color:#3f20ba;-webkit-text-decoration:none;text-decoration:none;}.css-844n2c a[href]:not([class]):hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-844n2c a[href]:not([class]) code{color:inherit;}.css-844n2c h1:not(:hover) a svg,.css-844n2c h2:not(:hover) a svg,.css-844n2c h3:not(:hover) a svg,.css-844n2c h4:not(:hover) a svg,.css-844n2c h5:not(:hover) a svg,.css-844n2c h6:not(:hover) a svg{visibility:hidden;}.css-844n2c h1 code,.css-844n2c h2 code,.css-844n2c h3 code,.css-844n2c h4 code,.css-844n2c h5 code,.css-844n2c h6 code{white-space:normal;}.css-844n2c h1 a.anchor:hover,.css-844n2c h2 a.anchor:hover,.css-844n2c h3 a.anchor:hover,.css-844n2c h4 a.anchor:hover,.css-844n2c h5 a.anchor:hover,.css-844n2c h6 a.anchor:hover{opacity:0.8;}.css-844n2c h1 a.anchor svg,.css-844n2c h2 a.anchor svg,.css-844n2c h3 a.anchor svg,.css-844n2c h4 a.anchor svg,.css-844n2c h5 a.anchor svg,.css-844n2c h6 a.anchor svg{fill:#3f20ba;}.css-844n2c h1 a.anchor.before,.css-844n2c h2 a.anchor.before,.css-844n2c h3 a.anchor.before,.css-844n2c h4 a.anchor.before,.css-844n2c h5 a.anchor.before,.css-844n2c h6 a.anchor.before{top:auto;}.css-844n2c *:not(style) + h2,.css-844n2c *:not(style) + h3,.css-844n2c *:not(style) + h4{margin-top:56px;}.css-844n2c img{display:block;max-width:100%;margin:0 auto;}.css-844n2c .mermaid svg{max-width:100%;}</style><div class="content-wrapper css-844n2c e694h6z2"><p>Akv2k8s consist of three main components to integrate with Azure Key Vault:</p><ul><li>a Custom Resource Definition called <code class="language-text">AzureKeyVaultSecret</code></li><li>Controller</li><li>Env Injector</li></ul><h2 id="the-azurekeyvaultsecret-crd" style="position:relative"><a href="#the-azurekeyvaultsecret-crd" aria-label="the azurekeyvaultsecret crd permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The AzureKeyVaultSecret CRD</h2><p>The <code class="language-text">AzureKeyVaultSecret</code> Custom Resource Definition (CRD) contains metadata used by the Controller and Env Injector to access objects in Azure Key Vault. For each secret, certificate or key in AzureKeyVault you want to make available in Kubernetes, you create a <code class="language-text">AzureKeyVaultSecret</code> and provide the following information:</p><ul><li>The Kubernetes namespace where the Azure Key Vault secret should be available</li><li>The name of the Azure Key Vault</li><li>The name, type and version (optional) of the Azure Key Vault object</li><li>Optionally which Kubernetes <code class="language-text">Secret</code> name and data-key to create </li></ul><p>An example <code class="language-text">AzureKeyVaultSecret</code> looks like this:</p><div class="gatsby-highlight" data-language="yaml"><style data-emotion-css="1gcd36t">.css-1gcd36t{margin-bottom:1.45rem;border:1px solid #DEE2E7;border-radius:4px;}</style><div class="css-1gcd36t e1ulzjg70"><style data-emotion-css="j1ow3a">.css-j1ow3a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;padding:10px;border-bottom:1px solid #DEE2E7;}</style><div class="css-j1ow3a e1ulzjg71"><style data-emotion-css="1pl2i23 dtw560">.css-1pl2i23{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-1pl2i23[disabled],.css-1pl2i23[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-1pl2i23:hover,.css-1pl2i23[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-1pl2i23:focus,.css-1pl2i23[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-1pl2i23:active,.css-1pl2i23[data-force-active-state]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}.css-dtw560{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><button class="css-1pl2i23"><div class="css-dtw560">Copy</div></button></div><style data-emotion-css="r8v8pb">.css-r8v8pb{padding:15px;background-color:#F4F6F8;overflow:auto;}</style><div class="css-r8v8pb e1ulzjg73"><pre class="language-yaml line-numbers"><code class="language-yaml"><span class="token comment"># secret-sync.yaml</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> spv.no/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> AzureKeyVaultSecret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret<span class="token punctuation">-</span>sync 
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> akv<span class="token punctuation">-</span>test
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">vault</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> akv2k8s<span class="token punctuation">-</span>test <span class="token comment"># name of key vault</span>
    <span class="token key atrule">object</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>secret <span class="token comment"># name of the akv object</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> secret <span class="token comment"># akv object type</span>
  <span class="token key atrule">output</span><span class="token punctuation">:</span> <span class="token comment"># optional - only used to sync to a kubernetes secret</span>
    <span class="token key atrule">secret</span><span class="token punctuation">:</span> 
      <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>secret<span class="token punctuation">-</span>from<span class="token punctuation">-</span>akv <span class="token comment"># kubernetes secret name</span>
      <span class="token key atrule">dataKey</span><span class="token punctuation">:</span> secret<span class="token punctuation">-</span>value <span class="token comment"># key to store object value in kubernetes secret</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><h2 id="the-controller" style="position:relative"><a href="#the-controller" aria-label="the controller permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Controller</h2><p>The Controller is responsible for syncing Azure Key Vault objects into Kubernetes <code class="language-text">Secret</code>&#x27;s, for all <code class="language-text">AzureKeyVaultSecret</code>&#x27;s having <code class="language-text">spec.output.secret</code> defined (like in the example above).</p><p>Periodically the Controller will poll Azure Key Vault for version changes of the secret and apply any changes to the Kubernetes <code class="language-text">Secret</code>.</p><blockquote><p><strong>Note-1: Pods in Kubernetes currently do not get notifications when Secret resources change, and Pods will have to be re-created or use something like the Wave controller (<a href="https://github.com/pusher/wave" target="_blank" rel="noopener noreferrer">https://github.com/pusher/wave</a>) to get the changes</strong></p></blockquote><blockquote><p><strong>Note-2: By default the Controller auto sync secrets every 10 minutes (configurable) and depending on how many secrets are synchronized can cause extra usage costs of Azure Key Vault.</strong></p></blockquote><h2 id="the-env-injector" style="position:relative"><a href="#the-env-injector" aria-label="the env injector permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Env Injector</h2><p>The Env Injector is a bit more complex than the Controller and consists of:</p><ul><li>a Mutating Admission Webhook (see <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#mutatingadmissionwebhook" target="_blank" rel="noopener noreferrer">Kubernetes docs</a>)</li><li>a Docker image (spvest/azure-keyvault-env) containing the <code class="language-text">azure-keyvault-env</code> executable</li></ul><p>Below is an outline of the steps that gets executed when a Pod is scheduled to start, in a namespace enabled for Env-Injector.</p><style data-emotion-css="1khl73p">.css-1khl73p{margin-left:12px;border-left:1px solid #3f20ba;list-style:none;}</style><ul class="css-1khl73p e1yz1yf65"><style data-emotion-css="mkoluw">.css-mkoluw{margin-bottom:0;padding-left:20px;font-size:1rem;line-height:1.5;position:relative;}.css-mkoluw:first-of-type h4{margin-top:0;}.css-mkoluw:not(:last-child){margin-bottom:28px;}.css-mkoluw h4{line-height:1.3;}</style><li class="css-mkoluw e1yz1yf66"><style data-emotion-css="8kwpls">.css-8kwpls{height:24px;width:24px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border:1px solid #3f20ba;border-radius:50%;font-size:14px;color:#3f20ba;text-align:center;background-color:white;position:absolute;top:0;left:-12px;}.css-8kwpls svg{height:14px;width:14px;}</style><div class="css-8kwpls e1yz1yf64">1</div><h3 id="the-mutating-admission-webhook-triggers" style="position:relative"><a href="#the-mutating-admission-webhook-triggers" aria-label="the mutating admission webhook triggers permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Mutating Admission Webhook triggers</h3><p>The Env Injector webhook gets triggered just before every Pod gets created and inspects the Pod definition for environment variables with values containing <code class="language-text">@azurekeyvault</code> (see example below). If it does not find any, the Pod starts as normal. If it does find environment variables with values containing <code class="language-text">@azurekeyvault</code>, it mutates (changes) the Pod with:</p><ul><li>A init-container (image: spvest/azure-keyvault-env) with these volumes:<ul><li>A in-memory volume at <code class="language-text">/azure-keyvault/</code></li><li>A host volume at <code class="language-text">/etc/kubernetes/azure.json</code> (only for default auth)</li></ul></li><li>Changes the executable for the Pod container (more on that later)</li></ul><p>Example where environment variable has value containing <code class="language-text">@azurekeyvault</code>:</p><div class="gatsby-highlight" data-language="yaml"><div class="css-1gcd36t e1ulzjg70"><div class="css-j1ow3a e1ulzjg71"><button class="css-1pl2i23"><div class="css-dtw560">Copy</div></button></div><div class="css-r8v8pb e1ulzjg73"><pre class="language-yaml line-numbers"><code class="language-yaml"><span class="token key atrule">env</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> MY_AKV_SECRET
    <span class="token key atrule">value</span><span class="token punctuation">:</span> some<span class="token punctuation">-</span>secret@azurekeyvault</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span></span></pre></div></div></div><p>As mentioned, the Pod container gets mutated to use a different executable. It does this by changing either the CMD or the ENTRYPOINT, depending on which was used by the original container, to use the <code class="language-text">azure-keyvault-env</code> executable instead. The &quot;old&quot; command gets passed in as parameter to this new executable.</p></li><li class="css-mkoluw e1yz1yf66"><div class="css-8kwpls e1yz1yf64">2</div><h3 id="the-pod-starts-the-init-container" style="position:relative"><a href="#the-pod-starts-the-init-container" aria-label="the pod starts the init container permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Pod starts the init-container</h3><p>When the Env Injector webhook is finished, Kubernetes will start the Pod with its new changes. This will trigger the following sequence:</p><ol><li>The init-container will start</li><li>The init-container copies the <code class="language-text">azure-keyvault-env</code> executable into <code class="language-text">/azure-keyvault/</code></li><li>If default authentication is used, the <code class="language-text">/etc/kubernetes/azure.json</code> located on the node, containing Azure AKS default credentials is copied to <code class="language-text">/azure-keyvault/</code></li></ol><p>The volume <code class="language-text">/azure-keyvault/</code> is a shared in-memory volume accessible to both the init-container and the original container. This is how the init-container can &quot;give&quot; the original container access to files.</p><blockquote><p>Note: All files located in the volume <code class="language-text">/azure-keyvault/</code> will be deleted as soon as the original container starts up. It would be a security issue to have these files available to the container after startup.</p></blockquote></li><li class="css-mkoluw e1yz1yf66"><div class="css-8kwpls e1yz1yf64">3</div><h3 id="the-pod-starts-the-original-container" style="position:relative"><a href="#the-pod-starts-the-original-container" aria-label="the pod starts the original container permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Pod starts the original container</h3><p>When the original container starts it will execute the <code class="language-text">azure-keyvault-env</code> command, which will:</p><ol><li>Connect to Azure Key Vault, using credentials found in <code class="language-text">/azure-keyvault/azure.json</code> (when default auth is used) - or use custom credentials</li><li>Download any Azure Key Vault secrets, identified by the environment placeholders</li><li>Delete all content from the shared volume <code class="language-text">/azure-keyvault/</code>:<ol><li>Delete itself (<code class="language-text">azure-keyvault-env</code>)</li><li>Delete <code class="language-text">/azure-keyvault/azure.json</code> - default credentials</li></ol></li><li>Execute the original command and params, pass on the updated environment variables with real secret values</li></ol></li><li class="css-mkoluw e1yz1yf66"><div class="css-8kwpls e1yz1yf64"><style data-emotion-css="18m6i0q">.css-18m6i0q{overflow:visible;height:15px;}.css-18m6i0q *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 22 15" class="css-18m6i0q"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.61.831L7.915 14.278 1.127 7.065"></path></svg></div><p><strong>The end result is that all secrets gets injected transparently in-memory during container startup. It will not reveal any secret content in the container spec, disk or logs. The only component that can read the secrets, are the program running inside the container. </strong></p></li></ul></div><style data-emotion-css="1f6gfyy">.css-1f6gfyy{display:none;margin-top:48px;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;}@media (max-width:1120px){.css-1f6gfyy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}@media (max-width:850px){.css-1f6gfyy{display:none;}}@media (max-width:600px){.css-1f6gfyy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-top:24px;}}</style><div class="css-1f6gfyy e694h6z7"><style data-emotion-css="rntvij">.css-rntvij{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:0;}.css-rntvij:not(:last-child){margin-bottom:16px;}</style><h5 class="css-rntvij e694h6z5"><style data-emotion-css="rq9thv">.css-rq9thv{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#5A6270;-webkit-text-decoration:none;text-decoration:none;}.css-rq9thv:hover{color:#959DAA;}.css-rq9thv svg{width:20px;height:20px;margin-right:6px;fill:currentColor;}</style><a target="_blank" rel="noopener noreferrer" href="https://github.com/sparebankenvest/azure-key-vault-to-kubernetes/tree/master/docs/source/content/how-it-works.mdx" class="css-rq9thv e694h6z6"><style data-emotion-css="12oh1jh">.css-12oh1jh{overflow:visible;height:26px;}.css-12oh1jh *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 26 26" class="css-12oh1jh"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><path fill="currentColor" fill-rule="nonzero" d="M15.425 22.985V20.95c0-1.081-.371-1.876-1.112-2.385.465-.045.891-.107 1.279-.188a9.967 9.967 0 0 0 1.233-.348 6.039 6.039 0 0 0 1.166-.543c.344-.21.674-.482.991-.817.317-.335.583-.715.797-1.139.215-.424.384-.933.509-1.527a9.543 9.543 0 0 0 .188-1.963c0-1.384-.451-2.563-1.353-3.537.411-1.072.366-2.237-.134-3.497l-.335-.04c-.232-.027-.65.071-1.253.295-.603.224-1.279.589-2.03 1.098a12.317 12.317 0 0 0-3.309-.442c-1.152 0-2.251.147-3.296.442a11.41 11.41 0 0 0-1.346-.797 6.948 6.948 0 0 0-1.018-.429 3.503 3.503 0 0 0-1.132-.154.844.844 0 0 0-.134.027c-.5 1.268-.545 2.434-.134 3.497-.902.973-1.353 2.152-1.353 3.537 0 .715.063 1.369.188 1.963.125.594.295 1.103.509 1.527.214.424.48.804.797 1.139.317.335.647.607.991.817.344.21.732.391 1.166.543a9.54 9.54 0 0 0 1.233.348c.389.08.815.143 1.279.188-.732.5-1.098 1.295-1.098 2.385v2.075C10.5 24 14 24 15.425 22.985z"></path><circle cx="12" cy="12" r="12" stroke="currentColor" stroke-width="1.5"></circle></g></svg> Edit on GitHub</a></h5></div><style data-emotion-css="9ckfit">.css-9ckfit{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:64px 0;}@media (max-width:850px){.css-9ckfit{padding:32px 0;}}</style><nav class="css-9ckfit e1sfxy7w0"><style data-emotion-css="spe9v1">.css-spe9v1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-spe9v1 svg{height:16px;width:16px;}.css-spe9v1:hover{opacity:0.8;}</style><a class="css-spe9v1 e1sfxy7w1" href="/quick-start/"><svg viewBox="0 0 14 24" class="css-10zhkrl"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.5.75L1.78 11.47a.749.749 0 0 0-.001 1.059l.001.001L12.5 23.25"></path></svg><style data-emotion-css="16mhdhi">.css-16mhdhi{margin-left:24px;text-align:left;}@media (max-width:850px){.css-16mhdhi{margin-left:16px;}}</style><div class="css-16mhdhi e1sfxy7w2"><style data-emotion-css="1vhhq4p">.css-1vhhq4p{-webkit-letter-spacing:0.142em;-moz-letter-spacing:0.142em;-ms-letter-spacing:0.142em;letter-spacing:0.142em;text-transform:uppercase;font-size:12px;}</style><div class="css-1vhhq4p e1sfxy7w3">Previous</div><style data-emotion-css="mtbysh">.css-mtbysh{color:#2F353F;}</style><div class="css-mtbysh e1sfxy7w4">Quick Start</div></div></a><a style="margin-left:auto" class="css-spe9v1 e1sfxy7w1" href="/installation/"><style data-emotion-css="18eg9eb">.css-18eg9eb{margin-right:24px;text-align:right;}@media (max-width:850px){.css-18eg9eb{margin-right:16px;}}</style><div class="css-18eg9eb e1sfxy7w2"><div class="css-1vhhq4p e1sfxy7w3">Next</div><div class="css-mtbysh e1sfxy7w4">Overview</div></div><svg viewBox="0 0 24 24" class="css-10zhkrl"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5.5.75l10.72 10.72a.749.749 0 0 1 .001 1.059l-.001.001L5.5 23.25"></path></svg></a></nav></div><style data-emotion-css="cw47jp">.css-cw47jp{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:240px;max-height:calc(100vh - 64px);margin-top:-36px;padding:40px 0;margin-left:40px;position:-webkit-sticky;position:sticky;top:64px;}@media (max-width:1120px){.css-cw47jp{display:none;}}@media (max-width:850px){.css-cw47jp{display:block;}}@media (max-width:600px){.css-cw47jp{display:none;}}</style><aside class="css-cw47jp e694h6z3"><style data-emotion-css="35ezg3">.css-35ezg3{font-weight:600;}</style><h4 class="css-35ezg3 e694h6z4">How it Works</h4><style data-emotion-css="1b603mp">.css-1b603mp{margin-left:0;margin-bottom:48px;overflow:auto;}</style><ul class="css-1b603mp e1wyoreh0"><style data-emotion-css="a8oa9s">.css-a8oa9s{list-style:none;font-size:1rem;line-height:inherit;}.css-a8oa9s a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-a8oa9s a:hover{opacity:0.8;}</style><li class="css-a8oa9s e1wyoreh1"><a href="#the-azurekeyvaultsecret-crd">The AzureKeyVaultSecret CRD</a></li><li class="css-a8oa9s e1wyoreh1"><a href="#the-controller">The Controller</a></li><li class="css-a8oa9s e1wyoreh1"><a href="#the-env-injector">The Env Injector</a></li></ul><h5 class="css-rntvij e694h6z5"><a target="_blank" rel="noopener noreferrer" href="https://github.com/sparebankenvest/azure-key-vault-to-kubernetes/tree/master/docs/source/content/how-it-works.mdx" class="css-rq9thv e694h6z6"><svg viewBox="0 0 26 26" class="css-12oh1jh"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><path fill="currentColor" fill-rule="nonzero" d="M15.425 22.985V20.95c0-1.081-.371-1.876-1.112-2.385.465-.045.891-.107 1.279-.188a9.967 9.967 0 0 0 1.233-.348 6.039 6.039 0 0 0 1.166-.543c.344-.21.674-.482.991-.817.317-.335.583-.715.797-1.139.215-.424.384-.933.509-1.527a9.543 9.543 0 0 0 .188-1.963c0-1.384-.451-2.563-1.353-3.537.411-1.072.366-2.237-.134-3.497l-.335-.04c-.232-.027-.65.071-1.253.295-.603.224-1.279.589-2.03 1.098a12.317 12.317 0 0 0-3.309-.442c-1.152 0-2.251.147-3.296.442a11.41 11.41 0 0 0-1.346-.797 6.948 6.948 0 0 0-1.018-.429 3.503 3.503 0 0 0-1.132-.154.844.844 0 0 0-.134.027c-.5 1.268-.545 2.434-.134 3.497-.902.973-1.353 2.152-1.353 3.537 0 .715.063 1.369.188 1.963.125.594.295 1.103.509 1.527.214.424.48.804.797 1.139.317.335.647.607.991.817.344.21.732.391 1.166.543a9.54 9.54 0 0 0 1.233.348c.389.08.815.143 1.279.188-.732.5-1.098 1.295-1.098 2.385v2.075C10.5 24 14 24 15.425 22.985z"></path><circle cx="12" cy="12" r="12" stroke="currentColor" stroke-width="1.5"></circle></g></svg> Edit on GitHub</a></h5></aside></div></div></main></div></div></div><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/how-it-works/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-1b0f35c4bd434e55dffd.js"],"component---node-modules-gatsby-theme-apollo-docs-src-components-template-js":["/component---node-modules-gatsby-theme-apollo-docs-src-components-template-js-29549b3bf4f45980f26c.js"],"component---node-modules-gatsby-theme-apollo-core-src-pages-404-js":["/component---node-modules-gatsby-theme-apollo-core-src-pages-404-js-d8fa35f731a92ca6b772.js"]};/*]]>*/</script><script src="/webpack-runtime-3f707e416190fd69708e.js" async=""></script><script src="/app-1b0f35c4bd434e55dffd.js" async=""></script><script src="/commons-487d38bec414ba5177c2.js" async=""></script><script src="/component---node-modules-gatsby-theme-apollo-docs-src-components-template-js-29549b3bf4f45980f26c.js" async=""></script><script src="/styles-1032cb06ce8f894b6274.js" async=""></script></body></html>